# SomeThink 常见问题与解决方案

## 🐛 安装问题

### 问题1: SSL证书验证错误

**错误信息**:
```
SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED]'))
```

**解决方案**:
```bash
pip install -r requirements.txt --trusted-host pypi.org --trusted-host files.pythonhosted.org --trusted-host pypi.python.org
```

### 问题2: Meta tensor错误

**错误信息**:
```
Cannot copy out of meta tensor; no data!
```

**原因**: PyTorch/Sentence-Transformers版本不兼容

**解决方案**:
1. 使用最小安装模式（仅关键词搜索）：
```bash
pip install -r requirements-minimal.txt
```

2. 或更新到兼容版本：
```bash
pip install --upgrade torch sentence-transformers
```

### 问题3: 缺少依赖库

**错误信息**:
```
ModuleNotFoundError: No module named 'xxx'
```

**解决方案**:
```bash
# 重新安装所有依赖
pip install -r requirements.txt --force-reinstall
```

## 🔍 运行问题

### 问题4: FTS5 UPSERT错误

**错误信息**:
```
UPSERT not implemented for virtual table "files_fts"
```

**解决方案**: 已在最新版本修复。如果仍遇到此问题：
1. 删除旧数据库：`rm ~/.config/SomeThink/somethink.db`（Linux/macOS）
2. 重新运行程序

### 问题5: 导入错误

**错误信息**:
```
ImportError: attempted relative import beyond top-level package
```

**解决方案**: 确保从正确的目录运行：
```bash
cd somethink
python main.py
```

不要使用 `python -m main`

### 问题6: 模型下载失败

**错误信息**:
```
HTTPError 403 or timeout
```

**解决方案**:
1. 检查网络连接
2. 使用最小安装模式（不需要下载模型）
3. 手动下载模型后放到 `~/.cache/huggingface/` 目录

## 💡 功能问题

### 问题7: 搜索结果为空

**可能原因**:
1. 文件未被索引
2. 索引路径不正确
3. 文件内容为空或不可读

**解决方案**:
1. 检查设置中的索引路径
2. 点击"重建索引"
3. 查看终端输出的错误信息

### 问题8: 语义搜索不工作

**现象**: 只显示文件名匹配的结果

**可能原因**:
1. 模型加载失败
2. 文档数量不足（<10个）
3. 使用了最小安装模式

**解决方案**:
- 查看启动日志，确认模型是否成功加载
- 确保索引了至少10个有内容的文档
- 如需语义搜索，使用完整安装：`pip install -r requirements.txt`

### 问题9: 索引速度慢

**优化建议**:
1. 排除不必要的目录（如node_modules、.git等）
2. 减少索引的文件数量
3. 首次索引后，后续会使用增量更新

### 问题10: 内存占用高

**解决方案**:
1. 使用最小安装模式
2. 减少索引的文件数量
3. 关闭其他占用内存的应用

## 🖥️ 平台特定问题

### macOS: 无法打开文件

**错误**: "应用没有权限"

**解决方案**: 在系统设置中授予SomeThink文件访问权限

### Windows: 路径问题

**错误**: 路径包含反斜杠导致错误

**解决方案**: 程序会自动处理，如仍有问题，使用正斜杠 `/`

### Linux: 文件监控不工作

**解决方案**: 安装inotify工具：
```bash
sudo apt-get install inotify-tools
```

## 📊 性能优化

### 优化1: 加快首次索引

1. 使用SSD硬盘
2. 排除大文件夹
3. 限制索引深度

### 优化2: 提高搜索速度

1. 定期清理数据库：
```bash
# 在Python中
from data.database import Database
db = Database("path/to/db")
db.conn.execute("VACUUM")
```

2. 重建索引和主题模型

### 优化3: 减少内存占用

在 `config.json` 中设置：
```json
{
  "model_name": "paraphrase-MiniLM-L3-v2",  // 更小的模型
  "max_results": 20  // 减少返回结果数
}
```

## 🆘 获取帮助

### 查看日志

运行时查看终端输出，错误信息会显示在那里。

### 调试模式

编辑 `main.py`，在开头添加：
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 重置应用

完全重置（删除所有数据）：

**macOS/Linux**:
```bash
rm -rf ~/Library/Application\ Support/SomeThink  # macOS
rm -rf ~/.config/SomeThink  # Linux
```

**Windows**:
```powershell
Remove-Item -Recurse -Force "$env:APPDATA\SomeThink"
```

### 联系支持

如果以上方法都无法解决问题：
1. 检查 GitHub Issues
2. 提交新Issue，包含：
   - 错误信息
   - 系统信息（OS、Python版本）
   - 重现步骤

## 📝 已知限制

1. **大文件处理**: 超过100MB的单个文件可能导致内存问题
2. **中文分词**: 默认模型对中文支持有限，可以尝试中文优化模型
3. **实时监控**: 当前版本需要手动重建索引
4. **OCR**: 图片文字识别默认未启用

## 🔄 版本兼容性

- **Python**: 3.8 - 3.11（推荐3.10）
- **macOS**: 10.14+
- **Windows**: 10+
- **Linux**: Ubuntu 18.04+

---

**提示**: 大多数问题可以通过使用最小安装模式 + 重建索引来解决。
