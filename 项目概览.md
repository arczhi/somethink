# SomeThink 项目概览

## 📁 项目结构

```
somethink/
├── README.md                   # 项目说明文档
├── 技术细节文档.md              # 技术架构详细说明
├── 快速开始.md                  # 快速开始指南
├── LICENSE                     # MIT许可证
├── requirements.txt            # Python依赖列表
├── .gitignore                  # Git忽略配置
│
├── main.py                     # 主程序入口
├── run.py                      # 启动脚本
├── __init__.py                 # 包初始化
│
├── gui/                        # GUI界面模块
│   ├── __init__.py
│   └── main_window.py          # 主窗口和设置窗口
│
├── engine/                     # 搜索引擎模块
│   ├── __init__.py
│   ├── indexer.py             # 文件索引器
│   └── searcher.py            # 搜索匹配器
│
├── models/                     # 机器学习模型模块
│   ├── __init__.py
│   └── topic_model.py         # BERTopic主题模型
│
├── utils/                      # 工具模块
│   ├── __init__.py
│   ├── config.py              # 配置管理
│   └── file_scanner.py        # 文件扫描器
│
└── data/                       # 数据持久化模块
    ├── __init__.py
    └── database.py            # SQLite数据库操作
```

## 🔧 核心模块说明

### 1. GUI模块 (`gui/`)
- **main_window.py**: 使用CustomTkinter实现的极简界面
  - 搜索框：实时搜索，300ms防抖
  - 结果列表：显示文件信息、主题、相关度
  - 设置窗口：管理索引路径、查看统计信息

### 2. 搜索引擎模块 (`engine/`)

#### indexer.py - 索引器
- 扫描指定目录下的文件
- 提取文本内容（支持PDF、DOCX、PPTX等）
- 多线程后台索引
- 实时进度回调

#### searcher.py - 搜索器
- 多策略搜索：关键词 + 语义
- 综合评分算法
- Top-K结果返回

### 3. 模型模块 (`models/`)

#### topic_model.py - 主题模型
- 基于BERTopic的主题建模
- Sentence-Transformers文本嵌入
- UMAP降维 + HDBSCAN聚类
- 相似文档检索

### 4. 工具模块 (`utils/`)

#### config.py - 配置管理
- 跨平台配置目录
- JSON配置持久化
- 性能自适应模型选择

#### file_scanner.py - 文件扫描
- 支持多种文件格式
- 元数据提取
- 文本内容提取

### 5. 数据模块 (`data/`)

#### database.py - 数据库
- SQLite3本地存储
- FTS5全文搜索
- 文件、主题、元数据表
- 统计信息查询

## 🌊 数据流程

### 索引流程
```
文件系统 → FileScanner → Indexer → Database
                                  ↓
                            TopicModel
```

1. FileScanner扫描文件，提取元数据和内容
2. Indexer将信息存入Database
3. TopicModel读取所有文档，训练主题模型
4. 主题分配结果更新回Database

### 搜索流程
```
用户查询 → Searcher → [关键词搜索 + 语义搜索] → 综合评分 → 返回结果
                           ↓              ↓
                       Database      TopicModel
```

1. 用户输入查询词
2. Searcher并行执行关键词搜索和语义搜索
3. 关键词搜索使用SQLite FTS5
4. 语义搜索使用TopicModel相似度计算
5. 综合评分并排序返回结果

## 🔑 关键技术点

### 1. 轻量级模型选择
- 默认: `all-MiniLM-L6-v2` (80MB, 22M参数)
- 低配: `paraphrase-MiniLM-L3-v2` (60MB)
- 根据系统内存自动选择

### 2. 性能优化
- **多线程**: 索引在后台线程执行，不阻塞UI
- **防抖**: 搜索输入300ms防抖，减少无效查询
- **缓存**: SQLite索引缓存，FTS5加速全文搜索
- **增量更新**: 检测文件修改时间，避免重复索引

### 3. 数据库设计
- **files表**: 存储文件基本信息和内容
- **topics表**: 存储主题关键词
- **files_fts**: FTS5虚拟表，加速全文搜索
- **索引**: path、topic_id、file_type建立索引

### 4. 搜索算法
```python
综合分数 = 0.4 × 关键词分数 + 0.5 × 语义分数 + 0.1 × 元数据分数
```

## 📊 配置文件

### 配置目录位置
- **macOS**: `~/Library/Application Support/SomeThink/`
- **Windows**: `%APPDATA%/SomeThink/`
- **Linux**: `~/.config/SomeThink/`

### config.json 示例
```json
{
  "model_name": "all-MiniLM-L6-v2",
  "index_paths": [
    "/Users/username/Documents",
    "/Users/username/Desktop"
  ],
  "exclude_patterns": [".git", "node_modules", "__pycache__"],
  "max_results": 50,
  "auto_index": true,
  "search_debounce_ms": 300,
  "theme": "dark",
  "language": "auto"
}
```

### 文件组织
```
~/.config/SomeThink/          # 或其他平台对应目录
├── config.json               # 配置文件
├── somethink.db             # SQLite数据库
└── models/                  # 模型文件
    ├── topic_model.pkl      # BERTopic模型
    └── embeddings.npy       # 文档嵌入向量
```

## 🚀 扩展开发建议

### 添加新文件类型支持
1. 在 `file_scanner.py` 的 `SUPPORTED_EXTENSIONS` 添加扩展名
2. 实现对应的 `_extract_xxx_text()` 方法

### 添加新搜索策略
1. 在 `searcher.py` 中添加新的搜索方法
2. 在 `_combine_results()` 中整合评分

### 优化主题模型
1. 调整 `topic_model.py` 中的UMAP/HDBSCAN参数
2. 尝试不同的embedding模型
3. 添加中文停用词支持

### 改进UI
1. 在 `main_window.py` 添加新组件
2. 实现文件预览功能
3. 添加搜索历史记录

## 📚 依赖说明

### 核心依赖
- **customtkinter**: 现代化Tkinter UI框架
- **bertopic**: 主题建模
- **sentence-transformers**: 文本嵌入
- **umap-learn**: 降维
- **hdbscan**: 聚类

### 文件处理
- **PyPDF2**: PDF文本提取
- **python-docx**: DOCX文本提取
- **python-pptx**: PPTX文本提取
- **mutagen**: 音频元数据
- **Pillow**: 图片处理

## 🎯 开发路线图

### v0.1.0 (当前版本)
- [x] 基础索引功能
- [x] 关键词搜索
- [x] 主题建模
- [x] 语义搜索
- [x] 极简GUI

### v0.2.0 (计划中)
- [ ] 实时文件监控（watchdog）
- [ ] 增量索引
- [ ] 搜索历史
- [ ] 文件预览

### v0.3.0 (未来)
- [ ] 云同步
- [ ] 插件系统
- [ ] AI对话查询
- [ ] 网络搜索集成

## 🤝 贡献指南

欢迎贡献！请遵循以下步骤：

1. Fork项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启Pull Request

## 📄 许可证

MIT License - 详见 LICENSE 文件

---

**技术支持**: 查看 `技术细节文档.md` 了解更多架构细节  
**快速开始**: 查看 `快速开始.md` 了解安装和使用方法
